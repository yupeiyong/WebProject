(function(n){"use strict";var i=n.fn.bootstrapTable.utils.sprintf,h=n.fn.bootstrapTable.utils.objectKeys,c=function(t,i,r){i=n.trim(i);a(t,i)||t.append(n("<option><\/option>").attr("value",i).text(n("<div />").html(r).text()))},l=function(t){var i=t.find("option:gt(0)");i.sort(function(t,i){return t=n(t).text().toLowerCase(),i=n(i).text().toLowerCase(),n.isNumeric(t)&&n.isNumeric(i)&&(t=parseFloat(t),i=parseFloat(i)),t>i?1:t<i?-1:0});t.find("option:gt(0)").remove();t.append(i)},a=function(n,t){var r=n.get(n.length-1).options,i;if(!r)return!1;for(i=0;i<r.length;i++)if(r[i].value===t.toString())return!0;return!1},v=function(t){var u=t.$tableHeader.find(".th-inner"),i,r;if(!t.options.filterControl||!t.options.height){t.$tableHeader.css("height",null);u.css({"margin-top":null,"margin-bottom":null});return}i=0;u.each(function(){var t=n(this).height();i<t&&(i=t)});u.each(function(){var r=n(this),u=r.height(),t;i>u&&(t=(i-u)/2+"px",r.css({"margin-top":t,"margin-bottom":t}))});r=i;r+=t.options.isSingleAll?53:79;t.$tableHeader.css("height",r+"px").parent().css("padding-bottom",r-1+"px")},r=function(n){var t=n.$header;return n.options.height&&(t=n.$tableHeader),t},u=function(n){var t="select, input";return n.options.height&&(t="table select, table input"),t},y=function(t){var i,r,u;return n.fn.bootstrapTable.utils.isIEBrowser()?n(t).is("input")?(i=0,"selectionStart"in t?i=t.selectionStart:"selection"in document&&(t.focus(),r=document.selection.createRange(),u=document.selection.createRange().text.length,r.moveStart("character",-t.value.length),i=r.text.length-u),i):-1:-1},p=function(t,i){n.fn.bootstrapTable.utils.isIEBrowser()&&(t.setSelectionRange!==undefined?t.setSelectionRange(i,i):n(t).val(t.value))},f=function(t){var i=r(t),f=u(t);t.options.valuesFilterControl=[];i.find(f).each(function(){t.options.valuesFilterControl.push({filterFlag:n(this).attr("data-u-filter-flag"),field:n(this).closest("[data-field]").data("field"),value:n(this).val(),position:y(n(this).get(0))})})},e=function(t){var f="",e=null,i=[],o=r(t),s=u(t);t.options.valuesFilterControl.length>0&&o.find(s).each(function(){f=n(this).attr("data-u-filter-flag");e=n(this).closest("[data-field]").data("field");i=n.grep(t.options.valuesFilterControl,function(n){return n.field===e&&n.filterFlag===f});i.length>0&&(n(this).val(i[0].value),p(n(this).get(0),i[0].position))})},w=function(){var t=[],i=document.cookie.match(/(?:bs.table.)(\w*)/g);if(i)return n.each(i,function(i,r){/./.test(r)&&(r=r.split(".").pop());n.inArray(r,t)===-1&&t.push(r)}),t},b=function(t){var i=t.options.data,s=t.pageTo<t.options.data.length?t.options.data.length:t.pageTo,r=function(n){return n.filterControl&&n.filterControl.toLowerCase()==="select"&&n.searchable},u=function(n){return n.filterData===undefined||n.filterData.toLowerCase()==="column"},f=function(n){return n&&n.length>0},e=t.options.pagination?t.options.sidePagination==="server"?t.pageTo:t.options.totalRows:t.pageTo;n.each(t.header.fields,function(s,h){var y=t.columns[n.fn.bootstrapTable.utils.getFieldIndex(t.columns,h)],c=n(".bootstrap-table-filter-control-"+o(y.field)),a,l,v,w,p;if(r(y)&&u(y)&&f(c)){for(c.get(c.length-1).options.length===0&&n.fn.bootstrapTable.defaults.filterControlExpose.addOptionToSelectControl(c,"","--请选择--"),a={},l=0;l<e;l++)v=i[l][h],w=n.fn.bootstrapTable.utils.calculateObjectValue(t.header,t.header.formatters[s],[v,i[l],l],v),a[w]=v;for(p in a)n.fn.bootstrapTable.defaults.filterControlExpose.addOptionToSelectControl(c,a[p],p);n.fn.bootstrapTable.defaults.filterControlExpose.sortSelectControl(c)}})},o=function(n){return String(n).replace(/(:|\.|\[|\]|,)/g,"\\$1")},k=function(t,i){var e=!1,u,r,f=!0;if(n.each(t.columns,function(s,h){var c,l,v,a;if((u="hidden",r=[],h.visible)&&(h.filterControl?(r.push('<div style="height: 60px;margin: 0 2px 2px 2px;" class="filterControl">'),h.filterControl.toLowerCase().substr(-1)==="2"&&(f=!1),c=h.filterControl.toLowerCase(),h.searchable&&t.options.filterTemplate[c]&&(e=!0,u="visible",r.push(t.options.filterTemplate[c](t,h.field,u)))):r.push('<div style="height: 60px;"><\/div>'),n.each(i.children().children(),function(t,i){return i=n(i),i.data("field")===h.field?(i.find(".fht-cell").append(r.join("")),!1):void 0}),h.filterData!==undefined&&h.filterData.toLowerCase()!=="column"))if(l=g(n.fn.bootstrapTable.defaults.filterControlExpose.filterDataMethods,h.filterData.substring(0,h.filterData.indexOf(":"))),l!==null)v=h.filterData.substring(h.filterData.indexOf(":")+1,h.filterData.length),a=n(".bootstrap-table-filter-control-"+o(h.field)),n.fn.bootstrapTable.defaults.filterControlExpose.addOptionToSelectControl(a,"","--请选择--"),l(v,a);else throw new SyntaxError('Error. You should use any of these allowed filter data methods: var, json, url. Use like this: var: {key: "value"}');}),f&&(t.options.isSingleAll=f),e){i.children().children().off("keypress");i.off("keyup","input").on("keyup","input",function(n){if((n.keyCode||n.which)===13){t.onColumnSearch(n);return!1}}).click(function(){return!1});i.off("change","select").on("change","select",function(n){t.onColumnSearch(n)});i.find(".date-filter-control").length>0&&n.each(t.columns,function(t,r){if(r.filterControl!==undefined&&r.filterControl.toLowerCase()==="datepicker")i.find(".date-filter-control.bootstrap-table-filter-control-"+r.field).datepicker(r.filterDatepickerOptions).on("changeDate",function(t){n(t.currentTarget).keyup()})})}else i.find(".filterControl").hide()},s=function(n){n=n===undefined?"left":n.toLowerCase();switch(n){case"left":return"ltr";case"right":return"rtl";case"auto":return"auto";default:return"ltr"}},d={"var":function(t,i){var r=window[t];for(var u in r)n.fn.bootstrapTable.defaults.filterControlExpose.addOptionToSelectControl(i,u,r[u]);n.fn.bootstrapTable.defaults.filterControlExpose.sortSelectControl(i)},url:function(t,i){n.ajax({url:t,dataType:"json",success:function(t){for(var r in t)n.fn.bootstrapTable.defaults.filterControlExpose.addOptionToSelectControl(i,r,t[r]);n.fn.bootstrapTable.defaults.filterControlExpose.sortSelectControl(i)}})},json:function(t,i){var r=JSON.parse(t);for(var u in r)n.fn.bootstrapTable.defaults.filterControlExpose.addOptionToSelectControl(i,u,r[u]);n.fn.bootstrapTable.defaults.filterControlExpose.sortSelectControl(i)}},g=function(n,t){for(var r=Object.keys(n),i=0;i<r.length;i++)if(r[i]===t)return n[t];return null};n.extend(n.fn.bootstrapTable.defaults,{filterControl:!1,onColumnSearch:function(){return!1},filterShowClear:!1,alignmentSelectControlOptions:undefined,filterTemplate:{input:function(n,t,r){return i('<input type="text" class="form-control input-sm bootstrap-table-filter-control-%s" style="width: 100%; visibility: %s" data-u-filter-flag="filter-%s">',t,r,t)},select:function(n,t,r){return i('<select class="form-control input-sm bootstrap-table-filter-control-%s" style="width: 100%; visibility: %s" dir="%s" data-u-filter-flag="filter-%s"><\/select>',t,r,s(n.options.alignmentSelectControlOptions),t)},datepicker:function(n,t,r){return i('<input type="text" class="form-control input-sm date-filter-control bootstrap-table-filter-control-%s" style="width: 100%; visibility: %s" data-u-filter-flag="filter-%s">',t,r,t)}},valuesFilterControl:[],filterControlExpose:{getDirectionOfSelectOptions:s,createControls:k,copyValues:f,setValues:e,getCurrentSearchControls:u,getCurrentHeader:r,filterDataMethods:d,addOptionToSelectControl:c,sortSelectControl:l}});n.extend(n.fn.bootstrapTable.columnDefaults,{filterControl:undefined,filterData:undefined,filterDatepickerOptions:undefined,filterSelect2Options:{allowClear:!1,minimumResultsForSearch:-1},filterStrictSearch:!1,filterStartsWithSearch:!1});n.extend(n.fn.bootstrapTable.Constructor.EVENTS,{"column-search.bs.table":"onColumnSearch"});n.extend(n.fn.bootstrapTable.defaults.icons,{clear:"glyphicon-trash icon-clear"});n.extend(n.fn.bootstrapTable.locales,{formatClearFilters:function(){return"Clear Filters"}});n.extend(n.fn.bootstrapTable.defaults,n.fn.bootstrapTable.locales);var t=n.fn.bootstrapTable.Constructor,nt=t.prototype.init,tt=t.prototype.initToolbar,it=t.prototype.initHeader,rt=t.prototype.initBody,ut=t.prototype.initSearch;t.prototype.init=function(){if(this.options.filterControl){var n=this;Object.keys||h();this.options.valuesFilterControl=[];this.$el.on("reset-view.bs.table",function(){n.options.height&&(n.$tableHeader.find("select").length>0||n.$tableHeader.find("input").length>0)}).on("post-header.bs.table column-switch.bs.table load-success.bs.table",function(){e(n)}).on("post-header.bs.table",function(){v(n)})}nt.apply(this,Array.prototype.slice.apply(arguments))};t.prototype.initToolbar=function(){if(this.showToolbar=this.options.filterControl&&this.options.filterShowClear,tt.apply(this,Array.prototype.slice.apply(arguments)),this.options.filterControl&&this.options.filterShowClear){var r=this.$toolbar.find(">.btn-group"),t=r.find(".filter-show-clear");if(!t.length){t=n(['<button class="btn btn-default filter-show-clear" ',i('type="button" title="%s">',this.options.formatClearFilters()),i('<i class="%s %s"><\/i> ',this.options.iconsPrefix,this.options.icons.clear),"<\/button>"].join("")).appendTo(r);t.off("click").on("click",n.proxy(this.clearFilterControl,this))}}};t.prototype.initHeader=function(){(it.apply(this,Array.prototype.slice.apply(arguments)),this.options.filterControl)&&n.fn.bootstrapTable.defaults.filterControlExpose.createControls(this,this.$header)};t.prototype.initBody=function(){rt.apply(this,Array.prototype.slice.apply(arguments));b(this)};t.prototype.initSearch=function(){if(ut.apply(this,Array.prototype.slice.apply(arguments)),this.options.sidePagination!=="server"){var t=this,i=n.isEmptyObject(this.filterColumnsPartial)?null:this.filterColumnsPartial;this.data=i?n.grep(this.data,function(r,u){var e,o,f,h,s;for(e in i){o=t.columns[n.fn.bootstrapTable.utils.getFieldIndex(t.columns,e)];f=r[e];for(h in i[e])if(s=i[e][h].toLowerCase(),o&&o.searchFormatter&&(f=n.fn.bootstrapTable.utils.calculateObjectValue(t.header,t.header.formatters[n.inArray(e,t.header.fields)],[f,r,u],f)),o.filterStrictSearch){if(!(n.inArray(e,t.header.fields)!==-1&&(typeof f=="string"||typeof f=="number")&&f.toString().toLowerCase()===s.toString().toLowerCase()))return!1}else if(o.filterStartsWithSearch){if(!(n.inArray(e,t.header.fields)!==-1&&(typeof f=="string"||typeof f=="number")&&(f+"").toLowerCase().indexOf(s)===0))return!1}else if(!(n.inArray(e,t.header.fields)!==-1&&(typeof f=="string"||typeof f=="number")&&(f+"").toLowerCase().indexOf(s)!==-1))return!1}return!0}):this.data}};t.prototype.initColumnSearch=function(n){if(f(this),n){this.filterColumnsPartial=n;this.updatePagination();for(var t in n)this.trigger("column-search",t,n[t])}};t.prototype.onColumnSearch=function(t){var e,s;if(!(n.inArray(t.keyCode,[37,38,39,40])>-1)){f(this);var r=n(t.currentTarget),h=r.closest("[data-field]"),o=r.attr("data-u-flter-flag"),u=n.trim(r.val()),i=h.data("field");n.isEmptyObject(this.filterColumnsPartial)&&(this.filterColumnsPartial={});u?(e={},e[o]=u,s=this.filterColumnsPartial[i]||{},this.filterColumnsPartial[i]=n.extend(!0,{},s,e)):(delete this.filterColumnsPartial[i][o],n.isEmptyObject(this.filterColumnsPartial[i])&&delete this.filterColumnsPartial[i]);this.searchText+="randomText";this.options.pageNumber=1;this.onSearch(t);this.trigger("column-search",i,u)}};t.prototype.clearFilterControl=function(){var h;if(this.options.filterControl&&this.options.filterShowClear){var t=this,o=w(),s=r(t),f=s.closest("table"),e=s.find(u(t)),l=t.$toolbar.find(".search input"),c=0;if(n.each(t.options.valuesFilterControl,function(n,t){t.value=""}),e.length>0)this.filterColumnsPartial={},n(e[0]).trigger(e[0].tagName==="INPUT"?"keyup":"change");else return;if(l.length>0&&t.resetSearch(),(t.options.sortName!==f.data("sortName")||t.options.sortOrder!==f.data("sortOrder"))&&(h=s.find(i('[data-field="%s"]',n(e[0]).closest("table").data("sortName"))),h.length>0)){t.onSort(f.data("sortName"),f.data("sortName"));n(h).find(".sortable").trigger("click")}clearTimeout(c);c=setTimeout(function(){o&&o.length>0&&n.each(o,function(n,i){t.deleteCookie!==undefined&&t.deleteCookie(i)})},t.options.searchTimeOut)}}})(jQuery);
//# sourceMappingURL=bootstrap-table-filter-control.min.js.map
